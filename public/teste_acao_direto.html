<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto - Edi√ß√£o de A√ß√£o</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; font-size: 14px; }
        #result { background: #333; color: #fff; padding: 10px; border-radius: 3px; white-space: pre-wrap; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üîß Teste Direto - Sistema de A√ß√µes</h1>
    
    <div class="section">
        <h3>1. Teste de Login/Sess√£o</h3>
        <button onclick="testAuth()">Verificar Autentica√ß√£o</button>
        <div id="authResult"></div>
    </div>
    
    <div class="section">
        <h3>2. Teste Buscar A√ß√£o</h3>
        <button onclick="testGetAction()">Buscar A√ß√£o ID 3</button>
        <div id="getResult"></div>
    </div>
    
    <div class="section">
        <h3>3. Teste Atualizar A√ß√£o</h3>
        <button onclick="testUpdateAction()">Atualizar A√ß√£o ID 3</button>
        <div id="updateResult"></div>
    </div>
    
    <div class="section">
        <h3>4. Debug Completo</h3>
        <div id="debugInfo"></div>
    </div>

    <script>
        function log(message, elementId = 'debugInfo') {
            const element = document.getElementById(elementId);
            const time = new Date().toLocaleTimeString();
            element.innerHTML += `[${time}] ${message}\n`;
            console.log(message);
        }

        async function testAuth() {
            log('üîê Testando autentica√ß√£o...', 'authResult');
            
            try {
                const response = await fetch('/crm');
                log(`Status: ${response.status}`, 'authResult');
                
                if (response.status === 200) {
                    log('‚úÖ Autentica√ß√£o OK', 'authResult');
                    document.getElementById('authResult').className = 'success';
                } else {
                    log('‚ùå Precisa fazer login', 'authResult');
                    document.getElementById('authResult').className = 'error';
                }
            } catch (error) {
                log('‚ùå Erro: ' + error.message, 'authResult');
                document.getElementById('authResult').className = 'error';
            }
        }

        async function testGetAction() {
            log('üîç Testando busca de a√ß√£o...', 'getResult');
            
            try {
                const response = await fetch('/action/3');
                log(`Status: ${response.status}`, 'getResult');
                log(`Content-Type: ${response.headers.get('content-type')}`, 'getResult');
                
                const text = await response.text();
                log(`Response: ${text}`, 'getResult');
                
                try {
                    const data = JSON.parse(text);
                    log('‚úÖ JSON v√°lido!', 'getResult');
                    document.getElementById('getResult').innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    document.getElementById('getResult').className = 'success';
                } catch (e) {
                    log('‚ùå JSON inv√°lido: ' + e.message, 'getResult');
                    document.getElementById('getResult').className = 'error';
                }
            } catch (error) {
                log('‚ùå Erro: ' + error.message, 'getResult');
                document.getElementById('getResult').className = 'error';
            }
        }

        async function testUpdateAction() {
            log('‚úèÔ∏è Testando atualiza√ß√£o de a√ß√£o...', 'updateResult');
            
            const formData = new FormData();
            formData.append('descricao', 'Teste de atualiza√ß√£o - ' + new Date().toLocaleString());
            formData.append('data_acao', new Date().toISOString().split('T')[0]);
            
            try {
                const response = await fetch('/action/3', {
                    method: 'POST',
                    body: formData
                });
                
                log(`Status: ${response.status}`, 'updateResult');
                log(`Content-Type: ${response.headers.get('content-type')}`, 'updateResult');
                
                const text = await response.text();
                log(`Response: ${text}`, 'updateResult');
                
                try {
                    const data = JSON.parse(text);
                    log('‚úÖ JSON v√°lido!', 'updateResult');
                    
                    if (data.success) {
                        log('üéâ Atualiza√ß√£o bem-sucedida!', 'updateResult');
                        document.getElementById('updateResult').className = 'success';
                    } else {
                        log('‚ùå Erro na atualiza√ß√£o: ' + data.message, 'updateResult');
                        document.getElementById('updateResult').className = 'error';
                    }
                } catch (e) {
                    log('‚ùå JSON inv√°lido: ' + e.message, 'updateResult');
                    document.getElementById('updateResult').className = 'error';
                }
            } catch (error) {
                log('‚ùå Erro: ' + error.message, 'updateResult');
                document.getElementById('updateResult').className = 'error';
            }
        }

        // Carregar informa√ß√µes iniciais
        window.onload = function() {
            log('üöÄ P√°gina carregada');
            log('URL Base: ' + window.location.origin);
            log('User Agent: ' + navigator.userAgent);
        };
    </script>
</body>
</html>